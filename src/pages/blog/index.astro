---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import BlogCard from '../../components/BlogCard.astro';
import { getCollection } from 'astro:content';

// 获取所有已发布的博客文章，按日期倒序排列
const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const sortedPosts = allPosts.sort((a, b) => {
  return b.data.pubDate.valueOf() - a.data.pubDate.valueOf();
});
---

<Layout title="博客 - KuroJim" description="我的博客文章列表">
  <Header currentPath="/blog" />

  <main class="flex-1 pt-14">
    <!-- Page Header -->
    <section class="py-20 sm:py-28 px-6 sm:px-8 bg-gradient-to-br from-apple-gray-50 to-white relative overflow-hidden">
      <!-- Decorative background -->
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-apple-blue/5 rounded-full blur-3xl"></div>

      <div class="max-w-5xl mx-auto relative z-10">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-semibold text-apple-gray-900 text-center mb-6 tracking-tight">
          博客
        </h1>
        <p class="text-lg text-apple-gray-600 text-center max-w-2xl mx-auto">
          分享我的学习心得、项目经验和思考
        </p>
      </div>
    </section>

    <!-- Blog Posts Grid -->
    <section class="py-16 px-6 sm:px-8">
      <div class="max-w-6xl mx-auto">
        {sortedPosts.length === 0 ? (
          <div class="text-center py-20">
            <p class="text-apple-gray-500 text-lg">暂无文章</p>
          </div>
        ) : (
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8">
            {sortedPosts.map((post) => (
              <BlogCard post={post} />
            ))}
          </div>
        )}
      </div>
    </section>
  </main>

  <Footer />
</Layout>
